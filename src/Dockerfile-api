# Copyright 2017 Carnegie Mellon University. All Rights Reserved. See LICENSE.md file for terms.

# multi-stage target: dev
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS dev

COPY Ghosts.Api/. /app/Ghosts.Api
COPY Ghosts.Domain/. /app/Ghosts.Domain
COPY Ghosts.Animator/. /app/Ghosts.Animator

WORKDIR /app/Ghosts.Api
RUN dotnet publish -c Release -o /app/dist
COPY Ghosts.Api/config /app/dist/config

# copy in binaries
# 7.2 TODO:// update these for v8
RUN wget -O /app/dist/config/binaries/windows/x64 "https://public.boxcloud.com/d/1/b1!ND19ZfAz3paVbwxMAvEuAjmQGb0xF2yINlJcSjVJMHuGCoymkacylzZHgdKS5MaTnTcED92M-QR5rGjy8EWU_bQ73dlhFgdUaiQtXIzJB4TXQEd2PrB2XvQx3-rkWb6VMk47V-YvdH7qNXYyj7P4WX7mUh9ORd0hY20RelhsozBMpxMD2eB5y8dbULH8w1x8tI4-hm0y_6JocIcaHrZygnPL7QUdd7Ik8f5nmqgfvnnc7dKBBShNtlQZQROPKGdPKLaR-qrn8BgJqEM9dWyUok3yG7QmFxoIvhfG2ZDkWpSV0T0YC1boBNQN1SDoAZeLkBiBuNoEHSDvN4JmQS8llljWoUT5qz4xXSrCePJxsezGbF1QmfR25hp9r37JCOkvYQC5GYLuidYsLKzieT-L6cSsJQwatVdphtnXOu2Xs_PEs_-MGuCzzeLKK0iIRt0FCcm8w2Fa1r-tVAFexA4zEOqUlHfk88cHboewCx0oNsEJJYzUg-IHySoP6mgxKJo7Y3FSNdd36rwWSxtkYrtyE075VI5x35nJcSGY3f1xhf66erLLg-W7kyXNuCdIUHauF9qs3YI_klpuJVBazWPaDk9grguqStL_a09cZ9Ot6KnFHeCHloYulf8oJOJo-vgT1zhbOs8VKWpMGwWrWY1Niz1_0lvQlD_UXjkPc6wzKc2DFFqIWDNsfqjjT2GZCqVLse2PHo4XmvCjEEsYbEfJemleo9RiCMBrryXtTL_Kw1nlQeUTQ3KkBCXPp4zueHHBvNCWpzU1lUoWhzXvwaXLpAHIB9piE6ERYpNMWIg9ZCzW3gkrEbAtDLiv01cj9x9T1HCuTEsVRZu9xP3hIxagOc4mdY8_nxP8oO-vB1QWuj6EsarZ_ZYWLADkJG7uVsmnWAig6uuzNvwedRUi2MLsopnTXz-8ewjvccsIzOVKxj9ARAodEHlxG6x5hB7wscwXLbV30TTT727xN2lOVvko80hWIFtC7TdSBOTpBngDUHHkVmqAb3O4dYs3KLPXxccuQRS4NQP00bgXyuEGldyGVMHkCXZ-HJI6l3Xc0tALGSGJS7trb5wvUTOJufD8TT95Cd7GN08HMF6fmSrVzHDRXAU27x2OLqMiA4vMV3LWcxQsQSFHekr2Mo0wbd_rmSoMvSn9TRzU3N_nCLG5L4PnWxNtJUVo9-ZX_tHnVMhfFFRzedztNk0auHsDvbvsevm7J-9zL9LBeZT1GAfVuZICvMyx8z4R0Q-5slLgrlUy10GRmNwy/download"
RUN wget -O /app/dist/config/binaries/windows/x32 "https://public.boxcloud.com/d/1/b1!p6NHmsIcashg36_ZtLBtzu-Th1i0xchvfPEFBVwPckk6IpYT3M7hUPRzHeqzVg3hpcl-6d5-wW4-QmN5dqYfh_LHrZAgeABp1AxiaTrrGpQWJFSonCwxAyoZaJq4qKJ1y7DyWMBBTyDM1n5_gUwViRRGQKV9JCGa8DOZ0tY7J9Xao5yiOOTeOwJpKJQQu-kyOOVoR9j7vjcN4JJeSX44IIT2glZ5ekkZjE-dO97DNKVZemHeYNC4JH-GtbN47fDFE2ytBTMmHuORe8PZbgFxWZeYlPx2NdijiHQLZ8ku9JmI55YrirZfL0JOUc9k_FTkaZufVK6Y3bUTWxoOHKEEUmD3i8kJfvzeMMxZ6Tjimj15kwMSlA5U3Tf-yKuSStjXSbLW5Xvez2Mbyi6VUkTvhGVYKfgli8_FvJjW6O4LFyJOtZ-Gcw1uf6rJt-1fieHmMslzA1O0UyfabE6Mx4VcxD2MOAI4ODaGOiSYOfmyP70U1kj5h41iXCMDRCT1U5XJr-rSUuMh5WCJb8c_0mzJ3ixrRupQaV-jmXVJ4857avneU6Z5pTP4OhQRIEMk1g1PJtC_3zDchFJxp8mvY2IIad4bP6R5i9fmmZmG18o3CPv3wnPQ0UhGsYUUGN3Ouhw6954hwJqHOGv0TFYqkQpfLImOi9at3ZA9hkiQi6FzoWz9XbzZkuFSVzNl16vnOIsblxQ3__zzWW-3bflIA056C1pM7_IXibMM7zCQhowpWAyO40Ju7-5NEjWuUnGPnbfYht-WdXu3zHDD2E1_Dhc35zc4yzciVYXEN1Kyr_SiOAH-gZ8yGxIio6vrWqZ6xbNsxMiCarVrMgtxKdRZwTzOut7GTPA50aPxaImUaJasqzIp4v2PjTE69pE2256CXiW5cOMnRd7YN-93HiuqYI08A4Jcoh-iMTu2v06k5_-qSFKXqX01eobFS8lkYbM-LU5yF2TV2bAK1B9dSWEjhPVE64d3C55Zcuso4cWvHCE2Ug5AhKqaupuHhQGA5P0o-1p7H8Hr0h93YCk09qGAahIgdDG0c1dRD_anYoNcnxIblIAavNTxDCLMt8fXKLZtxhyJBsutS29ZZD4gfER8SMkrKqVkI7AZLWdg2-vda9Q-iT3lOf9IiRiHHAIY3--0UHpvH5fpBK5-mMqsUzYXlmMus35aw_s7Ea4Tx4FNmcPd29AnxuJKYFdMK9Y54xr5xRg7CRfLtUUObdxLawBr-DjQ7zL6HVY1KHvjB0wKoIB6BR6EFYxD/download"
RUN wget -O /app/dist/config/binaries/linux "https://public.boxcloud.com/d/1/b1!nEjvocM0HPl9N13xAe6fpCvJDjfphAqbqCc-AeuXjQgMxvf_MwrvxNDQ1gwl5kb5g1ldEqQWUYVq29cZMFkJOz8__u9QiCu4vxbuhkA8p9Rej2EvwG-8u0x0ycuXecN5rE1-0drcRVPuRSlQF2sIpebqoG8a4SeEOarTeMIRmk2kvU_84MPi_7UUaop6NH5ZJ36FYSJLxwlGkmC5umJcjdJD7kowBAdi57dXFO3eRx9dJSYKj1Ve0CW_1oblHbuJXk6Hw9PMA5NSONYOHTyXWkq677cx4zt9At9GEJLx2gPgZOmFnvBsjrz80AX4XpI_-A9SSLaDQvYpSziqTkJ5IoO-SY06-PQRdtHqkgyRr1bgJEfdjw7QBIm_SlCr33wJH-KbW2p-0L0arSnX-sdHPZ3c_LLtZZ3UoiITNKfSXH2xbEIueYtl3WIbkPNtYYm9t6n0M5_SNaaOsYiXkDKyYC4f99zSFflh7bUh-hIeqY5ltgZMyBCs0qJxFXzFP81Hx5THVt2-ob9IMlE83ERhv55SwDDs9LMGiwCbGJdi7mCouTQIQ__5AQpFxf9TzKGV6XWlthznrh8kTL1sh2rIDe6lvPwfEePFpgFrhRsg4423TNjUyGFmki3_PxrZhdVIpMW2dSRcn3ZH8ZrXsXMrnYLXpefd9zn0XOtF4F1lauFs6Pkn4olm9AT3jsX4dri29t6VQJL9BnFiCqlZYDNOzLt0oqgvYZVbKgPGiWY-GWfWyELSHXm6JVx7p1Pc4yNzNkm8lL7cbU1TWOT1_dbie4tSlIQHB91auCzv_OmSEwZBMQkNeON4oQvljJWN1Gd7xmyO6uguGUP2cxlZB2mmu_9rKGATRQabzOA2819OxWDDM9bL45-C0GT2tTHYUOGl4yAZQFCwkVCxtE3yNue552urd84m2T8nS7Kvg4APde0nwP869qg6leZDsHmVUwq2U7OdQ5Y8e2rQybtTfOzD4EgsKUbd_52gG41Ad0fRMxfT9OB616NGt5Cl48Z7D2WhgkottNNs-Ws06rz-FhgMiAHyxWRVhTJluIzU-uDN6KCk3IqmcQ_FGcFHGcjGudsh8esHoiCLTrJK65zZHf-rTu4Q5Kqsf3WcxagZw-9OszAvYeHrNZLlvMjCFwss_nwUPVQ_SO0th3tsLVZRnQRRZfx7ABWlRm7KuUW1d4xrV8K4keW-X3-ldgyoJ_C8xgPG98KMLgwlSC6Bh8ZZFqjFESI3TumVOSLJoeBD0VWdihwwJxC7HOU./download"

CMD ["dotnet", "run"]

# multi-stage target: prod
FROM mcr.microsoft.com/dotnet/aspnet:8.0-alpine AS prod
ARG commit
ENV COMMIT=$commit
COPY --from=dev /app/dist /app
WORKDIR /app

LABEL "product"="GHOSTS API"
LABEL "maintainer"="Dustin Updyke <ddupdyke[-@-]sei.cmu.edu>"
LABEL "version"="Browse to /swagger"

EXPOSE 5000
ENV ASPNETCORE_URLS=http://*:5000 \
    ASPNETCORE_ENVIRONMENT=DEVELOPMENT

CMD ["dotnet", "ghosts.api.dll"]